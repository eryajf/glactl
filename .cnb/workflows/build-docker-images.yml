main:
  push:
    - runner:
        cpus: 8
      services:
        - docker
        - git-clone-yyds
      stages:
        - name: ğŸ“¦ æ„å»ºåˆ¶å“
          image: docker.cnb.cool/znb/images/debian:all
          script: |
            make gox-linux
        - name: ğŸ‹ æ¨é€é•œåƒ
          script: |
            docker run -d --name buildkitd \
              --security-opt seccomp=unconfined \
              --security-opt apparmor=unconfined \
              --security-opt systempaths=unconfined \
              moby/buildkit:rootless
            docker buildx create --use \
              --name mybuilder \
              --driver remote docker-container://buildkitd
            docker buildx build \
              -t ${CNB_DOCKER_REGISTRY}/${CNB_REPO_SLUG_LOWERCASE}:${CNB_BRANCH}_`date "+%Y%m%d%H%M%S"` \
              -t ${CNB_DOCKER_REGISTRY}/${CNB_REPO_SLUG_LOWERCASE} \
              --platform=linux/arm64,linux/amd64 . --push